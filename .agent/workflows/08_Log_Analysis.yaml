name: "Log Analysis Pipeline"
description: "íŒŒì´í”„ë¼ì¸ ì‹¤í–‰ ë¡œê·¸ë¥¼ ë¶„ì„í•˜ì—¬ ë³´í‹€ë„¥, ë¹„ìš©, ì‹¤íŒ¨ íŒ¨í„´ì„ ì§„ë‹¨í•˜ê³  ìµœì í™”ë¥¼ ì œì•ˆí•˜ëŠ” ë¶„ì„ ì›Œí¬í”Œë¡œìš° (Log Analyzer Team - 6 Agents)"
version: "1.0"

output_path: ".agent/dashboard/log_analysis_{YYYY-MM-DD}.md"
max_retries: 1  # step_6 ë°˜ë ¤ ì‹œ step_5ë¶€í„° ì¬ì‹¤í–‰ ìµœëŒ€ íšŸìˆ˜

logging:
  enabled: true
  protocol: ".agent/logging-protocol.md"
  model_config: ".opencode/oh-my-opencode.jsonc"
  path: ".agent/logs/{YYYY-MM-DD}_08_Log_Analysis.jsonl"
  format: "jsonl"

steps:
  # Phase 1: ìˆœì°¨ ì‹¤í–‰ â€” ë²”ìœ„ ê²°ì • â†’ ë°ì´í„° ìˆ˜ì§‘ â†’ ìŠ¤í‚¤ë§ˆ ê²€ì¦
  - id: step_0_scope
    agent: "08_log_analyzer/L0_Orchestrator"
    action: "define_scope"
    input: "User Request, Analysis Mode (auto/cost/performance/reliability/compare)"
    output: "Scope Definition (target logs, focus area, comparison baseline)"

  - id: step_1_collect
    agent: "08_log_analyzer/L1_Data_Collector"
    action: "run_analysis_script"
    depends_on: "step_0_scope"
    input: "Scope Definition, Script Path: .agent/scripts/analyze_logs.sh"
    output: "Data Packet (normalized JSON from script output)"
    notes: |
      ğŸ”§ New Analysis Scripts Available:
      - analyze_external_tools.sh: ë„êµ¬ë³„ ì‚¬ìš©ëŸ‰/ì„±ëŠ¥ ë¶„ì„
      - detect_anomalies.sh: ì‹¤íŒ¨ìœ¨/ì‘ë‹µì‹œê°„ ì´ìƒ ê°ì§€
      - analyze_api_costs.sh: API ë¹„ìš© ì¶”ì •
      These scripts are located in .agent/scripts/ and can be called by L1_Data_Collector.

  - id: step_2_validate
    agent: "08_log_analyzer/L1_Data_Collector"
    action: "validate_schema"
    depends_on: "step_1_collect"
    input: "Data Packet, Schema: .agent/logging-protocol.md"
    output: "Validation Result (pass/fail + details)"

  # Phase 2: ë³‘ë ¬ ì‹¤í–‰ â€” ì¸ì‚¬ì´íŠ¸ ë¶„ì„ê³¼ ìµœì í™” ì œì•ˆì€ ë…ë¦½ì ìœ¼ë¡œ ë™ì‹œ ì‹¤í–‰
  - id: step_3_insight
    agent: "08_log_analyzer/L2_Insight_Analyst"
    action: "analyze_patterns"
    parallel: true  # â† L3ì™€ ë³‘ë ¬ ì‹¤í–‰
    depends_on: "step_2_validate"
    input: "Data Packet, Scope Definition (focus area)"
    output: "Insight Packet (patterns, anomalies, trends)"

  - id: step_4_optimize
    agent: "08_log_analyzer/L3_Optimizer"
    action: "propose_optimizations"
    parallel: true  # â† L2ì™€ ë³‘ë ¬ ì‹¤í–‰
    depends_on: "step_2_validate"
    input: "Data Packet, Cost Table: .agent/logging-protocol.md Â§5"
    output: "Optimization Packet (proposals with ROI estimates)"

  # Phase 3: ë¦¬í¬íŠ¸ ì‘ì„± â€” L2+L3 ì‚°ì¶œë¬¼ í†µí•©
  - id: step_5_report
    agent: "08_log_analyzer/L4_Report_Writer"
    action: "write_report"
    depends_on:
      - "step_3_insight"
      - "step_4_optimize"
    input: "Insight Packet, Optimization Packet, Scope Definition"
    output: "Analysis Report (.agent/dashboard/log_analysis_{date}.md)"

  # Phase 4: QA ê²€ì¦
  - id: step_6_qa
    agent: "08_log_analyzer/L5_QA_Auditor"
    action: "verify_report"
    depends_on: "step_5_report"
    input: "Analysis Report, Data Packet (ground truth), Insight Packet, Optimization Packet"
    output: "QA Report (approved/rejected + checklist)"

  # Phase 5: ìµœì¢… ìŠ¹ì¸/ë°˜ë ¤
  - id: step_7_approval
    agent: "08_log_analyzer/L0_Orchestrator"
    action: "approve_report"
    depends_on: "step_6_qa"
    input: "QA Report, Analysis Report"
    decision:
      approved: "Finish"
      rejected: "Go to step_5_report"
