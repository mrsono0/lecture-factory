name: "Lecture Planning Pipeline"
description: "ê°•ì˜ ì£¼ì œ ì„ ì •ë¶€í„° ì»¤ë¦¬í˜ëŸ¼ í™•ì •ê¹Œì§€ì˜ ê¸°íš ë‹¨ê³„ ì›Œí¬í”Œë¡œìš° (Planner Team) âš ï¸ MUST ANALYZE CONTEXT: If a local folder is provided, analyze its contents using list_dir/read_file BEFORE proceeding."
version: "2.1"

output_path: "{YYYY-MM-DD_ê°•ì˜ì œëª©}/01_Planning/ê°•ì˜êµ¬ì„±ì•ˆ.md"
max_retries: 2  # step_7 ë°˜ë ¤ ì‹œ step_3ë¶€í„° ì¬ì‹¤í–‰ ìµœëŒ€ íšŸìˆ˜

logging:
  enabled: true
  protocol: ".agent/logging-protocol.md"
  model_config: ".opencode/oh-my-opencode.jsonc"
  path: ".agent/logs/{YYYY-MM-DD}_01_Lecture_Planning.jsonl"
  format: "jsonl"

steps:
  # Phase 1: ìˆœì°¨ ì‹¤í–‰ â€” ìŠ¤ì½”í”„ ì •ì˜ â†’ íŠ¸ë Œë“œ ë¦¬ì„œì¹˜ â†’ í•™ìŠµì ë¶„ì„ â†’ ì»¤ë¦¬í˜ëŸ¼ ì„¤ê³„
  
  # âš ï¸ Note on NotebookLM Execution (Critical)
  # Step 1 (A1_Trend_Researcher) requires NotebookLM URL execution.
  # Due to subagent limitations (skill() tool not accessible), the NotebookLM 
  # queries should be executed by the Main Agent before delegating to A1, 
  # OR A1 must use bash() tool to execute commands directly.
  # See: .agent/agents/01_planner/A1_Trend_Researcher.md Â§ğŸ”´ CRITICAL
  - id: step_0_scope
    agent: "01_planner/A0_Orchestrator"
    action: "analyze_request"
    input: "User Prompt, Lecture Topic File, NotebookLM URL (Optional), Output Language: Korean"
    output: "Scope Definition & Agent Task Beliefs"

  - id: step_1_trend_analysis
    agent: "01_planner/A1_Trend_Researcher"
    action: "research_trend"
    depends_on: "step_0_scope"
    input: "Scope Definition, Output Language: Korean"
    output: "Trend Report & Fact Packet (01_Planning/Trend_Report.md)"

    notes: |
      âš ï¸ NotebookLM Execution: A1 must execute bash commands to run notebooklm queries.
      Verification: Check Trend_Report.md contains "Query 1/2/3" with actual stdout.
      On Failure: A0 must reject and retry step_1_trend_analysis (see A0_Orchestrator.md Â§ğŸ”´ A1 ê²€ì¦ í”„ë¡œí† ì½œ)
    # Note: A1 uses Deep Research / NotebookLM skills here

  - id: step_2_learner_analysis
    agent: "01_planner/A5B_Learner_Analyst"
    action: "analyze_learner"
    depends_on: "step_1_trend_analysis"
    input: "Scope Definition, Trend Report, Output Language: Korean"
    output: "Learner Persona & Pain Points (01_Planning/ê°•ì˜êµ¬ì„±ì•ˆ.md ë‚´ í•™ìŠµì ë¶„ì„ ì„¹ì…˜)"

  - id: step_3_curriculum_design
    agent: "01_planner/A3_Curriculum_Architect"
    action: "design_structure"
    depends_on: "step_2_learner_analysis"
    input: "Learner Persona, Scope Definition, Trend Report, Output Language: Korean"
    output: "Curriculum Structure (Skeleton)"

  # Phase 2: ë³‘ë ¬ ì‹¤í–‰ â€” A2ì™€ A7ì€ ì„œë¡œ ì˜ì¡´ì„± ì—†ì´ ë™ì‹œ ì‹¤í–‰ ê°€ëŠ¥
  # Note: lecture-planner.mdì—ì„œ Task ë„êµ¬ë¡œ run_in_background: true ì„¤ì •
  - id: step_4_instructional_design
    agent: "01_planner/A2_Instructional_Designer"
    action: "design_activities"
    parallel: true  # â† A7ê³¼ ë³‘ë ¬ ì‹¤í–‰
    depends_on: "step_3_curriculum_design"
    input: "Curriculum Structure, Learner Persona, Output Language: Korean"
    output: "Learning Activities & Assessment Plan"

  - id: step_5_differentiation
    agent: "01_planner/A7_Differentiation_Advisor"
    action: "identify_usp"
    parallel: true  # â† A2ì™€ ë³‘ë ¬ ì‹¤í–‰
    depends_on: "step_3_curriculum_design"
    input: "Curriculum Structure, Trend Report, Output Language: Korean"
    output: "Differentiation Strategy (USP)"

  # Phase 2.5: í†µí•© â€” A3ê°€ A2+A7 ì‚°ì¶œë¬¼ì„ ì»¤ë¦¬í˜ëŸ¼ì— ë³‘í•©
  - id: step_5b_integration
    agent: "01_planner/A3_Curriculum_Architect"
    action: "integrate_outputs"
    depends_on:
      - "step_4_instructional_design"
      - "step_5_differentiation"
    input: "Curriculum Structure (Skeleton), Learning Activities (A2), Differentiation Strategy (A7), Output Language: Korean"
    output: "Integrated Curriculum Plan (A2 Learning Activities + A7 USP ë°˜ì˜ ì™„ê²°ë³¸)"

  # Phase 3: QA â€” í†µí•©ëœ ì»¤ë¦¬í˜ëŸ¼ì„ ê²€ì¦
  - id: step_6_qa_review
    agent: "01_planner/A5A_QA_Manager"
    action: "verify_plan"
    depends_on: "step_5b_integration"
    input: "Integrated Curriculum Plan, Output Language: Korean"
    output: "QA Report & Final Curriculum Plan"

  # Phase 4: ìµœì¢… ìŠ¹ì¸/ë°˜ë ¤
  - id: step_7_final_approval
    agent: "01_planner/A0_Orchestrator"
    action: "approve_deliverable"
    depends_on: "step_6_qa_review"
    input: "Final Curriculum Plan, QA Report, Output Language: Korean"
    decision:
      approved: "Finish"
      rejected: "Go to step_3_curriculum_design"
