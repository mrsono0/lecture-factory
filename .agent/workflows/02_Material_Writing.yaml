name: "Material Writing Pipeline"
description: "í™•ì •ëœ ì»¤ë¦¬í˜ëŸ¼ì„ ë°”íƒ•ìœ¼ë¡œ êµì•ˆ ë³¸ë¬¸ê³¼ ì½”ë“œë¥¼ ì‘ì„±í•˜ëŠ” ê°œë°œ ë‹¨ê³„ ì›Œí¬í”Œë¡œìš° (Writer Team - 11 Agents) âš ï¸ MUST ANALYZE CONTEXT: If a local folder is provided, analyze its contents using list_dir/read_file BEFORE proceeding."
version: "2.2"
output_path: "{YYYY-MM-DD_ê°•ì˜ì œëª©}/02_Material/ê°•ì˜êµì•ˆ_v1.0.md"
max_retries: 2
# â”€â”€ AM/PM ë¶„í•  ì¶œë ¥ ì •ì±… â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# A3(Curriculum Architect)ì˜ "ì˜¤ì „/ì˜¤í›„ ë¶„í•  ì„¤ê³„" ê·œì¹™(í•­ëª© 7)ê³¼ ì—°ë™.
# 1ì¼ ê°•ì˜ ì‹œê°„ì´ 4ì‹œê°„ì„ ì´ˆê³¼í•˜ë©´ ìµœì¢… ì‚°ì¶œë¬¼ì„ ì¼ìë³„ AM/PM íŒŒì¼ë¡œ ë¶„í•  ì¶œë ¥í•œë‹¤.
output_policy:
  split_threshold: "1ì¼ 4ì‹œê°„ ì´ˆê³¼"
  split_unit: "ë°˜ì¼(AM/PM)"
  file_naming: "Day{N}_{AM|PM}.md"
  output_dir: "{YYYY-MM-DD_ê°•ì˜ì œëª©}/02_Material/"
  rules:
    - "A3 ê³¨ê²© íŒ¨í‚·ì— AM/PM ë¶„í•  í”Œë˜ê·¸ê°€ ìˆìœ¼ë©´ A4ëŠ” ë°˜ì¼ ë‹¨ìœ„ë¡œ ë…ë¦½ íŒŒì¼ì„ ì‘ì„±í•œë‹¤"
    - "ê° íŒŒì¼ì€ ë…ë¦½ì ìœ¼ë¡œ ì½ì„ ìˆ˜ ìˆëŠ” ì™„ì „í•œ êµì•ˆì´ì–´ì•¼ í•œë‹¤ (í—¤ë”, í•™ìŠµëª©í‘œ, ë¸Œë¦¿ì§€ë…¸íŠ¸ í¬í•¨)"
    - "A8 QAëŠ” íŒŒì¼ë³„ ë…ë¦½ì„± + íŒŒì¼ê°„ êµì°¨ ì¼ê´€ì„±ì„ ëª¨ë‘ ê²€ì¦í•œë‹¤"
    - "íŒŒì¼ëª… íŒ¨í„´ì€ ë‹¤ìš´ìŠ¤íŠ¸ë¦¼ 03_visualizerì˜ Day{N}_{AM|PM} ì…ë ¥ ê·œì¹™ê³¼ ì¼ì¹˜ì‹œí‚¨ë‹¤"
  fallback: "4ì‹œê°„ ì´í•˜ì¸ ê²½ìš° ê¸°ì¡´ ë‹¨ì¼ íŒŒì¼(ê°•ì˜êµì•ˆ_v1.0.md) ì¶œë ¥"

logging:
  enabled: true
  protocol: ".agent/logging-protocol.md"
  model_config: ".opencode/oh-my-opencode.jsonc"
  path: ".agent/logs/{YYYY-MM-DD}_02_Material_Writing.jsonl"
  format: "jsonl"

steps:
  # Phase 1: ì†ŒìŠ¤ ë¶„ì„ ë° êµ¬ì¡°í™”
  - id: step_1_source_mining
    agent: "02_writer/A1_Source_Miner"
    action: "extract_facts"
    input: "Curriculum Plan, Source Materials, NotebookLM URL (Optional), Output Language: Korean"
    output: "Fact Packet"
    
    notes: |
      ğŸ“Š External Tool Logging: A1_Source_Miner must log all external tool calls
      (notebooklm, deep-research, context7, firecrawl, pdf-official) to
      .agent/logs/{DATE}_02_Material_Writing.jsonl using EXTERNAL_TOOL_START/END events.
      See A1_Source_Miner.md Â§ì™¸ë¶€ ë„êµ¬ í˜¸ì¶œ ë¡œê¹… for details.

  - id: step_2_traceability_setup
    agent: "02_writer/A2_Traceability_Curator"
    action: "setup_tracking"
    depends_on: "step_1_source_mining"
    input: "Fact Packet, Source Materials, Output Language: Korean"
    output: "Traceability Packet (Initial)"

  # Phase 2: ê³¨ê²© ë° ì´ˆì•ˆ ì‘ì„±
  - id: step_3_skeleton_design
    agent: "02_writer/A3_Curriculum_Architect"
    action: "create_skeleton"
    depends_on: "step_2_traceability_setup"
    input: "Fact Packet, Curriculum Plan, Output Language: Korean"
    output: "Skeleton Packet"

  - id: step_4_drafting
    agent: "02_writer/A4_Technical_Writer"
    action: "write_draft"
    depends_on: "step_3_skeleton_design"
    input: "Skeleton Packet, Fact Packet, Traceability Packet, Output Language: Korean"
    output: "Material Draft (v0.5)"

  # Phase 3: ìƒì„¸ ì„¤ê³„ ë° ê²€ì¦ (5ê°œ ë³‘ë ¬ ì‹¤í–‰)
  - id: step_5_code_validation
    agent: "02_writer/A5_Code_Validator"
    action: "verify_code"
    depends_on: "step_4_drafting"
    parallel_group: "phase3"
    input: "Material Draft, Output Language: Korean"
    output: "Verified Code Blocks & Tech Report"

  - id: step_6_visualization_design
    agent: "02_writer/A6_Visualization_Designer"
    action: "design_diagrams"
    depends_on: "step_4_drafting"
    parallel_group: "phase3"
    input: "Material Draft, Fact Packet, Output Language: Korean"
    output: "Visualization Packet (Mermaid/Tables)"

  - id: step_7_learner_experience
    agent: "02_writer/A7_Learner_Experience_Designer"
    action: "design_labs"
    depends_on: "step_4_drafting"
    parallel_group: "phase3"
    input: "Material Draft, Learner Persona, Output Language: Korean"
    output: "Lab Packet & Example Sets"

  - id: step_8_instructor_support
    agent: "02_writer/A9_Instructor_Support_Designer"
    action: "create_guide"
    depends_on: "step_4_drafting"
    parallel_group: "phase3"
    input: "Material Draft, Lab Packet, Output Language: Korean"
    output: "Instructor Support Packet"

  - id: step_9_differentiation
    agent: "02_writer/A10_Differentiation_Strategist"
    action: "enhance_content"
    depends_on: "step_4_drafting"
    parallel_group: "phase3"
    input: "Material Draft, Output Language: Korean"
    output: "Differentiation Strategy (USP)"

  # Phase 4: í†µí•© ë° ìµœì¢… QA
  - id: step_10_integration
    agent: "02_writer/A4_Technical_Writer"
    action: "finalize_draft"
    depends_on:
      - "step_5_code_validation"
      - "step_6_visualization_design"
      - "step_7_learner_experience"
      - "step_8_instructor_support"
      - "step_9_differentiation"
    input: "Material Draft, Verified Code, Visualization Packet, Lab Packet, Instructor Support Packet, Differentiation Strategy, Output Language: Korean"
    output: "Integrated Draft (v1.0)"

  - id: step_11_final_qa
    agent: "02_writer/A8_QA_Editor"
    action: "quality_assurance"
    depends_on: "step_10_integration"
    input: "Integrated Draft, Fact Packet, Traceability Packet, Output Language: Korean"
    output: "QA Report & Final Material"
    decision:
      approved: "Finish"
      rejected: "Go to step_4_drafting"
