name: "Lecture Planning Pipeline v2 - Micro Session Chunking"
description: "Gemini ìµœì í™”ëœ 15~25ë¶„ ë§ˆì´í¬ë¡œ ì„¸ì…˜ ì²­í‚¹ ê¸°ë°˜ ê°•ì˜ ê¸°íš ì›Œí¬í”Œë¡œìš° (Planner Team v2) âš ï¸ MUST ANALYZE CONTEXT: If a local folder is provided, analyze its contents using list_dir/read_file BEFORE proceeding."
version: "3.0"

output_path: "{YYYY-MM-DD_ê°•ì˜ì œëª©}/01_Planning/ê°•ì˜êµ¬ì„±ì•ˆ.md"
max_retries: 2  # step_9 ë°˜ë ¤ ì‹œ step_4ë¶€í„° ì¬ì‹¤í–‰ ìµœëŒ€ íšŸìˆ˜

# â”€â”€ ë§ˆì´í¬ë¡œ ì„¸ì…˜ ì²­í‚¹ ì •ì±… â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Gemini 3.1 Pro ì¶œë ¥ í† í° ìµœì í™”ë¥¼ ìœ„í•´ 15~25ë¶„ ë‹¨ìœ„ë¡œ ì„¸ë¶„í™”
micro_session_policy:
  enabled: true
  chunk_size: "15-25min"  # ë¶„ëŸ‰ ë‹¨ìœ„
  estimated_chars: "3000-4500"  # ì˜ˆìƒ êµì•ˆ ë¶„ëŸ‰ (ê³µë°± í¬í•¨)
  min_chars_per_session: 1500  # ê°•ì‚¬ ëŒ€ë³¸ ìµœì†Œ ë¶„ëŸ‰
  max_chars_per_session: 2000  # ê°•ì‚¬ ëŒ€ë³¸ ìµœëŒ€ ë¶„ëŸ‰
  chunk_types: ["narrative", "code", "diagram", "lab"]
  
  output_structure:
    index_file: "01_Planning/micro_sessions/_index.json"
    flow_file: "01_Planning/micro_sessions/_flow.md"
    dependency_file: "01_Planning/micro_sessions/_dependency.mmd"
    reference_mapping_file: "01_Planning/micro_sessions/_reference_mapping.json"
    session_dir: "01_Planning/micro_sessions/"
    session_pattern: "ì„¸ì…˜-{ë²ˆí˜¸:03d}-{ì œëª©}.md"
  
  rules:
    - "ë‹¨ì¼ ê°œë… ì›ì¹™: ê° ë§ˆì´í¬ë¡œ ì„¸ì…˜ì€ ë‹¨ 1ê°œì˜ í•µì‹¬ í•™ìŠµ ëª©í‘œë§Œ ë‹¤ë£¸"
    - "ì¶œë ¥ í•œê³„ ê³ ë ¤: Gemini 3.1 Proì˜ ì¶œë ¥ í† í° í•œê³„(3,000~4,500ì) ë‚´ì—ì„œ ì™„ê²°ì„± í™•ë³´"
    - "ì—°ì†ì„± ì„¤ê³„: ê° ì„¸ì…˜ì€ ì„ í–‰/í›„í–‰ ì„¸ì…˜ê³¼ ëª…í™•íˆ ì—°ê²°"
    - "ë…ë¦½ íŒŒì¼í™”: ê° ì„¸ì…˜ì€ ê°œë³„ íŒŒì¼ë¡œ ì €ì¥í•˜ì—¬ ê²€ìƒ‰/ìˆ˜ì • ìš©ì´"

logging:
  enabled: true
  protocol: ".agent/logging-protocol.md"
  model_config: ".opencode/oh-my-opencode.jsonc"
  path: ".agent/logs/{YYYY-MM-DD}_01_Lecture_Planning_v2.jsonl"
  format: "jsonl"

steps:
  # Phase 1: ìˆœì°¨ ì‹¤í–‰ â€” ìŠ¤ì½”í”„ ì •ì˜ â†’ íŠ¸ë Œë“œ ë¦¬ì„œì¹˜ â†’ í•™ìŠµì ë¶„ì„ â†’ ì»¤ë¦¬í˜ëŸ¼ ì„¤ê³„
  
  # âš ï¸ Note on NotebookLM Execution (Critical)
  # Step 1 (A1_Trend_Researcher) requires NotebookLM URL execution.
  # Due to subagent limitations (skill() tool not accessible), the NotebookLM 
  # queries should be executed by the Main Agent before delegating to A1, 
  # OR A1 must use bash() tool to execute commands directly.
  # See: .agent/agents/01_planner/A1_Trend_Researcher.md Â§ğŸ”´ CRITICAL
  - id: step_0_scope
    agent: "01_planner/A0_Orchestrator"
    action: "analyze_request"
    input: "User Prompt, Lecture Topic File, NotebookLM URL (Optional), Output Language: Korean"
    output: "Scope Definition & Agent Task Beliefs"
    notes: |
      ë§ˆì´í¬ë¡œ ì„¸ì…˜ v2 ì›Œí¬í”Œë¡œìš°ì„ì„ ëª…ì‹œí•˜ê³ , Gemini ìµœì í™”ëœ 15~25ë¶„ ì²­í‚¹ ì „ëµì„ ì„¤ëª…í•©ë‹ˆë‹¤.

  - id: step_1_trend_analysis
    agent: "01_planner/A1_Trend_Researcher"
    action: "research_trend"
    depends_on: "step_0_scope"
    input: "Scope Definition, Output Language: Korean"
    output: "Trend Report & Fact Packet (01_Planning/Trend_Report.md)"
    notes: |
      âš ï¸ NotebookLM Execution: A1 must execute bash commands to run notebooklm queries.
      Verification: Check Trend_Report.md contains "Query 1/2/3" with actual stdout.
      On Failure: A0 must reject and retry step_1_trend_analysis (see A0_Orchestrator.md Â§ğŸ”´ A1 ê²€ì¦ í”„ë¡œí† ì½œ)
      ğŸ“Š External Tool Logging: A1 must log each NotebookLM query to .agent/logs/{DATE}_01_Lecture_Planning_v2.jsonl using EXTERNAL_TOOL_START/END events (see logging-protocol.md Â§9.7)

  - id: step_2_learner_analysis
    agent: "01_planner/A5B_Learner_Analyst"
    action: "analyze_learner"
    depends_on: "step_1_trend_analysis"
    input: "Scope Definition, Trend Report, Output Language: Korean"
    output: "Learner Persona & Pain Points (01_Planning/ê°•ì˜êµ¬ì„±ì•ˆ.md ë‚´ í•™ìŠµì ë¶„ì„ ì„¹ì…˜)"

  - id: step_3_curriculum_design
    agent: "01_planner/A3_Curriculum_Architect"
    action: "design_structure"
    depends_on: "step_2_learner_analysis"
    input: "Learner Persona, Scope Definition, Trend Report, Output Language: Korean"
    output: "Curriculum Structure (Skeleton)"
    notes: |
      ê¸°ì¡´ 60~90ë¶„ ë‹¨ìœ„ ì„¸ì…˜ìœ¼ë¡œ ì´ˆì•ˆ ì„¤ê³„. A3Bì—ì„œ ë§ˆì´í¬ë¡œ ì„¸ì…˜ìœ¼ë¡œ ì„¸ë¶„í™”.

  # Phase 2: ë§ˆì´í¬ë¡œ ì„¸ì…˜ ì²­í‚¹ (Gemini ìµœì í™”)
  # NEW: A3Bê°€ ê¸°ì¡´ ì„¸ì…˜ì„ 15~25ë¶„ ë§ˆì´í¬ë¡œ ì„¸ì…˜ìœ¼ë¡œ ì„¸ë¶„í™”
  - id: step_4_micro_chunking
    agent: "01_planner/A3B_MicroSession_Specifier"
    action: "design_micro_sessions"
    depends_on: "step_3_curriculum_design"
    parallel_mode: "session_batch"  # ì„¸ì…˜ë³„ ë³‘ë ¬ ì²­í‚¹
    batch_size: 5  # í•œ ë²ˆì— ì²˜ë¦¬í•  ì„¸ì…˜ ìˆ˜
    input: 
      - "Curriculum Structure (Skeleton)"
      - "Learner Persona"
      - "Trend Report"
      - "micro_session_policy"
      - "Output Language: Korean"
    output: "Micro Session Specifications (01_Planning/micro_sessions/ì„¸ì…˜-*.md)"
    notes: |
      ğŸ¯ í•µì‹¬: ê¸°ì¡´ 60~90ë¶„ ì„¸ì…˜ì„ 15~25ë¶„ ë§ˆì´í¬ë¡œ ì„¸ì…˜ìœ¼ë¡œ ì„¸ë¶„í™”
      ğŸ“ ì‚°ì¶œë¬¼: ê° ë§ˆì´í¬ë¡œ ì„¸ì…˜ë³„ ê°œë³„ .md íŒŒì¼ + ë©”íƒ€ë°ì´í„° íƒœê·¸
      ğŸ·ï¸ íƒœê·¸: chunk_type (narrative|code|diagram|lab), complexity, estimated_chars
      ğŸ“ ë¶„ëŸ‰: ê° ì„¸ì…˜ 3,000~4,500ì ë¶„ëŸ‰ìœ¼ë¡œ ì„¤ê³„ (Gemini ì¶œë ¥ í•œê³„ ê³ ë ¤)
      âš ï¸ ë°˜ë“œì‹œ ê°œë³„ íŒŒì¼ë¡œ ì €ì¥í•˜ì—¬ downstreamì—ì„œ ì„¸ì…˜ë³„ ì§‘í•„ ê°€ëŠ¥í•˜ë„ë¡ í•¨

  # Phase 2.5: ì„¸ì…˜ ì¸ë±ì‹± ë° íë¦„ ì„¤ê³„
  # NEW: A3Cê°€ ë§ˆì´í¬ë¡œ ì„¸ì…˜ ê°„ ì˜ì¡´ì„±ê³¼ í•™ìŠµ ê²½ë¡œ ì„¤ê³„
  - id: step_5_session_indexing
    agent: "01_planner/A3C_Session_Indexer"
    action: "create_flow_index"
    depends_on: "step_4_micro_chunking"
    input: 
      - "Micro Session Specifications (All .md files)"
      - "Curriculum Structure"
      - "Output Language: Korean"
    output: 
      - "Master Index (01_Planning/micro_sessions/_index.json)"
      - "Flow Document (01_Planning/micro_sessions/_flow.md)"
      - "Dependency Graph (01_Planning/micro_sessions/_dependency.mmd)"
    notes: |
      ğŸ—ºï¸ ì˜ì¡´ì„± ê·¸ë˜í”„: Mermaid ë‹¤ì´ì–´ê·¸ë¨ìœ¼ë¡œ ì „ì²´ ì„¸ì…˜ íë¦„ ì‹œê°í™”
      ğŸ›¤ï¸ í•™ìŠµ ê²½ë¡œ: ê¸°ë³¸/ë³´ì¶©/ë‹¨ì¶• ê²½ë¡œ ì„¤ê³„
      ğŸ“Š ë‚œì´ë„ ê³¡ì„ : ì „ì²´ ì»¤ë¦¬í˜ëŸ¼ì˜ ë‚œì´ë„ ì§„í–‰ ì‹œê°í™”
      ğŸ”— ë¸Œë¦¿ì§€ ë…¸íŠ¸: ì„¸ì…˜ ê°„ ì „í™˜ ë©˜íŠ¸ ì˜ˆì‹œ ëª¨ìŒ

  # Phase 3: ë³‘ë ¬ ì‹¤í–‰ â€” A2ì™€ A7ì€ ì„œë¡œ ì˜ì¡´ì„± ì—†ì´ ë™ì‹œ ì‹¤í–‰ ê°€ëŠ¥
  - id: step_6_instructional_design
    agent: "01_planner/A2_Instructional_Designer"
    action: "design_activities"
    parallel: true  # â† A7ê³¼ ë³‘ë ¬ ì‹¤í–‰
    depends_on: "step_5_session_indexing"
    input: 
      - "Curriculum Structure"
      - "Micro Session Index"
      - "Learner Persona"
      - "Output Language: Korean"
    output: "Learning Activities & Assessment Plan (01_Planning/micro_sessions/_activities.md)"
    notes: |
      ê° ë§ˆì´í¬ë¡œ ì„¸ì…˜ë³„ í•™ìŠµ í™œë™ ì„¤ê³„. ê°œë³„ ì„¸ì…˜ íŒŒì¼ì— í™œë™ ì •ë³´ ì¶”ê°€.

  - id: step_7_differentiation
    agent: "01_planner/A7_Differentiation_Advisor"
    action: "identify_usp"
    parallel: true  # â† A2ì™€ ë³‘ë ¬ ì‹¤í–‰
    depends_on: "step_5_session_indexing"
    input: 
      - "Curriculum Structure"
      - "Micro Session Index"
      - "Trend Report"
      - "Output Language: Korean"
    output: "Differentiation Strategy (USP) per micro-session (01_Planning/micro_sessions/_differentiation.md)"

  # Phase 3.5: í†µí•© â€” A3ê°€ A2+A7 ì‚°ì¶œë¬¼ì„ ì»¤ë¦¬í˜ëŸ¼ì— ë³‘í•©
  - id: step_8_integration
    agent: "01_planner/A3_Curriculum_Architect"
    action: "integrate_outputs_v2"
    depends_on:
      - "step_6_instructional_design"
      - "step_7_differentiation"
    input: 
      - "Curriculum Structure (Skeleton)"
      - "Micro Session Index"
      - "Learning Activities (A2)"
      - "Differentiation Strategy (A7)"
      - "Output Language: Korean"
    output: "Integrated Curriculum Plan with Micro Sessions (Complete)"
    notes: |
      ëª¨ë“  ë§ˆì´í¬ë¡œ ì„¸ì…˜ ì •ë³´ë¥¼ í†µí•©í•˜ì—¬ ìµœì¢… ê°•ì˜êµ¬ì„±ì•ˆ ì™„ì„±.
      ë§ˆì´í¬ë¡œ ì„¸ì…˜ ë§í¬ì™€ ì˜ì¡´ì„± ê·¸ë˜í”„ë¥¼ ë©”ì¸ ë¬¸ì„œì— í¬í•¨.

  # Phase 4: QA â€” í†µí•©ëœ ì»¤ë¦¬í˜ëŸ¼ ê²€ì¦
  - id: step_9_qa_review
    agent: "01_planner/A5A_QA_Manager"
    action: "verify_plan_v2"
    depends_on: "step_8_integration"
    input: 
      - "Integrated Curriculum Plan"
      - "Micro Session Index"
      - "Dependency Graph"
      - "Output Language: Korean"
    output: "QA Report & Final Curriculum Plan"
    qa_criteria:
      - "ë§ˆì´í¬ë¡œ ì„¸ì…˜ë‹¹ ë‹¨ì¼ ê°œë… ì¤€ìˆ˜ ì—¬ë¶€"
      - "15~25ë¶„ ì‹œê°„ ë²”ìœ„ ì¤€ìˆ˜ ì—¬ë¶€"
      - "3,000~4,500ì ë¶„ëŸ‰ ì ì ˆì„±"
      - "ì„ í–‰/í›„í–‰ ì„¸ì…˜ ì—°ê²°ì„±"
      - "chunk_type íƒœê·¸ ì ì ˆì„±"
      - "ì˜ì¡´ì„± ê·¸ë˜í”„ ì™„ê²°ì„±"
    notes: |
      ë§ˆì´í¬ë¡œ ì„¸ì…˜ v2 íŠ¹í™” QA í•­ëª© ê²€ì¦:
      1. ê° ì„¸ì…˜ì´ ë‹¨ 1ê°œì˜ ê°œë…ë§Œ ë‹¤ë£¨ëŠ”ê°€?
      2. ì‹œê°„/ë¶„ëŸ‰ì´ Gemini ì¶œë ¥ í•œê³„ ë‚´ì— ìˆëŠ”ê°€?
      3. ì˜ì¡´ì„± ê·¸ë˜í”„ì— ê³ ë¦½/ìˆœí™˜ ì˜ì¡´ì„±ì´ ì—†ëŠ”ê°€?

  # Phase 5: ìµœì¢… ìŠ¹ì¸/ë°˜ë ¤
  - id: step_10_final_approval
    agent: "01_planner/A0_Orchestrator"
    action: "approve_deliverable_v2"
    depends_on: "step_9_qa_review"
    input: 
      - "Final Curriculum Plan"
      - "Micro Session Index"
      - "Dependency Graph"
      - "QA Report"
      - "Output Language: Korean"
    output: "Approved Lecture Plan with Micro Sessions"
    decision:
      approved: 
        action: "Finish"
        save_targets:
          - "01_Planning/ê°•ì˜êµ¬ì„±ì•ˆ.md"
          - "01_Planning/Trend_Report.md"
          - "01_Planning/micro_sessions/_index.json"
          - "01_Planning/micro_sessions/_flow.md"
          - "01_Planning/micro_sessions/_dependency.mmd"
          - "01_Planning/micro_sessions/_reference_mapping.json"
          - "01_Planning/micro_sessions/_activities.md"
          - "01_Planning/micro_sessions/_differentiation.md"
          - "01_Planning/micro_sessions/ì„¸ì…˜-*.md"
      rejected: 
        action: "Retry from step_4_micro_chunking"
        max_retries: 2
        notes: "ë°˜ë ¤ ì‹œ A3B_MicroSession_Specifierë¶€í„° ì¬ì‹¤í–‰"

# â”€â”€ ëª¨ë¸ ë¼ìš°íŒ… ì„¤ì • â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
model_routing:
  # ë§ˆì´í¬ë¡œ ì„¸ì…˜ ì²­í‚¹: Gemini 3.1 Pro (1M context, ì¶œë ¥ í’ˆì§ˆ ìµœì í™”)
  A3B_MicroSession_Specifier:
    category: "curriculum-chunking"
    note: "15~25min ë§ˆì´í¬ë¡œ ì„¸ì…˜ ì„¤ê³„ ë° Gemini ìµœì í™” íƒœê·¸ ë¶€ì—¬"
  
  # ì„¸ì…˜ ì¸ë±ì‹±: Gemini 3.1 Pro (ì˜ì¡´ì„± ê·¸ë˜í”„ ë° íë¦„ ì„¤ê³„)
  A3C_Session_Indexer:
    category: "curriculum-chunking"
    note: "ì˜ì¡´ì„± ê·¸ë˜í”„ ë° í•™ìŠµ ê²½ë¡œ ì„¤ê³„"
  
  # ê¸°ì¡´ ì—ì´ì „íŠ¸ëŠ” ê¸°ë³¸ ì¹´í…Œê³ ë¦¬ ìœ ì§€
  A3_Curriculum_Architect:
    category: "ultrabrain"
    note: "ì»¤ë¦¬í˜ëŸ¼ êµ¬ì¡° ì„¤ê³„ (ê¸°ì¡´ ì„¤ì • ìœ ì§€)"
  
  A7_Differentiation_Advisor:
    category: "artistry"
    note: "ì°¨ë³„í™” ì „ëµ ì„¤ê³„ (ê¸°ì¡´ ì„¤ì • ìœ ì§€)"

# â”€â”€ ë‹¤ìš´ìŠ¤íŠ¸ë¦¼ ì—°ë™ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
downstream_integration:
  # 02_Material_Writing_v2 ì—°ë™
  material_writing:
    input_format: "micro_session_based"
    session_files: "01_Planning/micro_sessions/ì„¸ì…˜-*.md"
    index_file: "01_Planning/micro_sessions/_index.json"
    flow_file: "01_Planning/micro_sessions/_flow.md"
    
    notes: |
      02_Material_Writing_v2ëŠ” ë§ˆì´í¬ë¡œ ì„¸ì…˜ë³„ ê°œë³„ êµì•ˆ ì‘ì„± í›„ ì·¨í•©í•˜ëŠ” ë°©ì‹.
      ê° ì„¸ì…˜ íŒŒì¼ì€ ë…ë¦½ì ìœ¼ë¡œ ì²˜ë¦¬ë˜ë©°, A4C_Material_Aggregatorê°€ ìµœì¢… í†µí•©.
